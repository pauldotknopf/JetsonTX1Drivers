<!DOCTYPE html ><html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>NVIDIA Tegra Linux Driver Package Development Guide</title><link rel="Prev" href="l4t_tx1_toolchain.html" title="Previous"><link rel="Next" href="l4t_downloads.html" title="Next"><link rel="StyleSheet" href="css/l4t_WDT_proc.css" type="text/css" media="all"><link rel="StyleSheet" href="css/skin.css" type="text/css" media="all"><link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all"><!--[if IE 7]><link rel="StyleSheet" href="css/l4t_WDT_proc_IE7.css" type="text/css" media="all"><![endif]--><link rel="StyleSheet" href="css/print.css" type="text/css" media="print"><script type="text/javascript" src="scripts/common.js"></script><script type="text/javascript" src="scripts/page.js"></script><script type="text/javascript" src="scripts/search-client.js"></script><script type="text/javascript" src="scripts/unidata.js"></script><script type="text/javascript" src="scripts/unibreak.js"></script></head><body id="pN7c1q5qY8s1luQdutTx1prw" class="ww_skin_page_body" style="background-attachment: scroll; background-position: center center; background-repeat: no-repeat; margin-left: 0pt; margin-right: 10pt" onload="Page.OnLoad('../index.html#page/Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_WDT_proc.html');"><header><div><table width="100%" align="center" summary=""><tr><td class="Header_Left"><img alt="NVIDIA Tegra" src="images/NVLogo_2D_H.jpg" width="204" height="44" border="0"></td><td class="Header_Right">
           Tegra Linux Driver Package<br>
           Development Guide <br><font size="-1">May 16, 2016 | 24.1 Release</font></td></tr></table></div><!--     <br clear="all">
 --><hr color="#DEE4F0"><div class="ww_skin_page_toolbar"><!-- Twitter --><!--         --><!-- FaceBook Like --><!--               --><!-- LinkedIn Share --><!--                --><!-- Google +1 --><!--           --><a class="ww_behavior_print ww_skin ww_skin_print" title="Print" href="#">&nbsp;</a></div></header><div id="wwpID0E03B0HA" class="Heading_1">Watchdog Timer</div><div id="wwpID0E02B0HA" class="Body_Text">If an application terminates or hangs, a Watchdog timer eventually expires, triggering a CPU reset, and enabling the system to recover without user intervention. The NVIDIA<span style="font-size: smaller; vertical-align: super">®</span> Tegra<span style="font-size: smaller; vertical-align: super">®</span> Linux Driver Package implements a watchdog timer WDT0, allocated to CPU0 of cluster0 or the shadow CPU of cluster1.</div><div id="wwpID0E01B0HA" class="List_Continue"><span class="Strong">Note</span>: For information about the available Tegra Watchdog Timers and configurations, see the “Watchdog Timers (WDTs)” section of the <span style="font-style: italic">Tegra Technical Reference Manual</span> (<span style="font-style: italic">TRM</span>) for your chip.</div><div id="wwpID0E0ZB0HA" class="Body_Text">WDT0 is not enabled in the Linux kernel by default; to enable, see <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_WDT_proc.html#wwpID0E0UB0HA" title="Watchdog Timer">To enable WDT0 from the Linux kernel</a></span> or <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_WDT_proc.html#wwpID0E0IB0HA" title="Watchdog Timer">To enable WDT0 from user space</a></span>. This hardware, when turned on, has a timer that starts decrementing. The default timeout value is 120 seconds. For Linux for Tegra (L4T), WDT0 is configured to use TIMER7; therefore, TIMER7 must not be used for any other purpose. When the timeout condition occurs, the WDT0 hardware sends a reset signal to the CPU that causes it to reset.</div><div id="wwpID0E0YB0HA" class="Body_Text">You can enable WDT0 from the kernel or from user space. If WDT0 is enabled in the kernel, during kernel boot, the kernel loads the WDT0 driver and then starts resetting, or “kicking” WDT0. This prevents the device restarting under normal operation.</div><div id="wwpID0E0XB0HA" class="Body_Text">If you already enabled the default WDT0 driver from the Linux kernel, your applications in the user space do not need to kick WDT0.</div><div id="wwpID0E0WB0HA" class="Body_Text">Alternatively, applications can manually enable WDT0 from user space using standard Linux system calls and then by kicking the watchdog periodically. For more information, see the sample code in <span class="Hyperlink"><a href="../Tegra%20Linux%20Driver%20Package%20Development%20Guide/l4t_WDT_proc.html#wwpID0E0IB0HA" title="Watchdog Timer">To enable WDT0 from user space</a></span>.</div><div id="wwpID0E0VB0HA" class="Body_Text">Normally, enabling WDT0 enablement is sufficient for system monitoring. If you need to enable Watchdog on other CPUs or AVP, you must modify the WDT driver.</div><div id="wwpID0E0UB0HA" class="Heading_5">To enable WDT0 from the Linux kernel</div><div id="wwpID0E0TB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Go to the kernel configuration file: </div><div id="wwpID0E0SB0HA" class="Code">arch/arm/configs/tegra12_defconfig</div><div id="wwpID0E0RB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Add the following 2 lines under <span class="Code_Char">CONFIG_WATCHDOG_NOWAYOUT=y</span>:</div><div id="wwpID0E0QB0HA" class="Code">CONFIG_TEGRA_WATCHDOG=y</div><div id="wwpID0E0PB0HA" class="Code">CONFIG_TEGRA_WATCHDOG_ENABLE_ON_PROBE=y</div><div id="wwpID0E0OB0HA" class="Heading_5">To modify the WDT0 timeout value</div><div id="wwpID0E0NB0HA" class="List_Number" style="margin-left: 54pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Go to the WDT kernel driver: </div><div id="wwpID0E0MB0HA" class="Code">drivers/watchdog/tegra_wdt.c</div><div id="wwpID0E0LB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Modify the heartbeat value. The default value is 120 seconds. The example below changes the timeout value to 60 seconds:</div><div id="wwpID0E0KB0HA" class="Code">-static int heartbeat = 120;</div><div id="wwpID0E0JB0HA" class="Code">+static int heartbeat = 60;</div><div id="wwpID0E0IB0HA" class="Heading_5">To enable WDT0 from user space</div><div id="wwpID0E0GB0HA" class="List_Number" style="margin-left: 54pt; text-indent: -18pt"><span class="WebWorks_Number" style="width: 18pt"><span>1.	</span></span>Go to the kernel configuration file: </div><div id="wwpID0E0FB0HA" class="Code">arch/arm/configs/tegra12_defconfig</div><div id="wwpID0E0EB0HA" class="List_Number"><span class="WebWorks_Number" style="width: 18pt"><span>2.	</span></span>Add the following line under <span class="Code_Char">CONFIG_WATCHDOG_NOWAYOUT=y</span>:</div><div id="wwpID0E0DB0HA" class="Code">CONFIG_TEGRA_WATCHDOG=y</div><div id="wwpID0E0CB0HA" class="List_Continue">The WDT0 device node is <span class="Code_Char">/dev/watchdog0</span>. The following user-space sample code shows opening, enabling, obtaining and specifiying the timeout value, and kicking the watchdog timer.</div><div id="wwpID0E0BB0HA" class="Code">int fd, ret;</div><div id="wwpID0E0AB0HA" class="Code">int timeout = 0;</div><div id="wwpID0E6HA" class="Code">&nbsp;</div><div id="wwpID0E5HA" class="Code">/* open WDT0 device (WDT0 enables itself automatically) */</div><div id="wwpID0E4HA" class="Code">fd = open("/dev/watchdog0", O_RDWR);</div><div id="wwpID0E3HA" class="Code">if(fd &lt; 0) {</div><div id="wwpID0E2HA" class="Code">    fprintf(stderr, "Open watchdog device failed!\n");</div><div id="wwpID0E1HA" class="Code">    return -1; </div><div id="wwpID0EZHA" class="Code">}</div><div id="wwpID0EYHA" class="Code">/* WDT0 is counting now,check the default timeout value */</div><div id="wwpID0EXHA" class="Code">ret = ioctl(fd, WDIOC_GETTIMEOUT, &amp;timeout);</div><div id="wwpID0EWHA" class="Code">if(ret) {</div><div id="wwpID0EVHA" class="Code">    fprintf(stderr, "Get watchdog timeout value failed!\n");</div><div id="wwpID0EUHA" class="Code">    return -1; </div><div id="wwpID0ETHA" class="Code">}</div><div id="wwpID0ESHA" class="Code">fprintf(stdout, "Watchdog timeout value: %d\n", timeout);</div><div id="wwpID0ERHA" class="Code">&nbsp;</div><div id="wwpID0EQHA" class="Code">/* set new timeout value 60s */</div><div id="wwpID0EPHA" class="Code">/* Note the value should be within [5, 1000] */</div><div id="wwpID0EOHA" class="Code">timeout = 60;</div><div id="wwpID0ENHA" class="Code">ret = ioctl(fd, WDIOC_SETTIMEOUT, &amp;timeout);</div><div id="wwpID0EMHA" class="Code">if(ret) {</div><div id="wwpID0ELHA" class="Code">    fprintf(stderr, "Set watchdog timeout value failed!\n");</div><div id="wwpID0EKHA" class="Code">    return -1;</div><div id="wwpID0EJHA" class="Code">}</div><div id="wwpID0EIHA" class="Code">fprintf(stdout, "New watchdog timeout value: %d\n", timeout);  </div><div id="wwpID0EHHA" class="Code">&nbsp;</div><div id="wwpID0EGHA" class="Code">/*Kick WDT0, this should be running periodically */</div><div id="wwpID0EFHA" class="Code">ret = ioctl(fd, WDIOC_KEEPALIVE, NULL);</div><div id="wwpID0EEHA" class="Code">if(ret) {</div><div id="wwpID0EDHA" class="Code">    fprintf(stderr, "Kick watchdog failed!\n");</div><div id="wwpID0ECHA" class="Code">    return -1;</div><div id="wwpID0EBHA" class="Code">}</div><footer><!-- Related Topics --><!--                --><!-- Disqus --><!--        --><!-- Google Translation --><!--                    --><br><hr color="#DEE4F0"><table width="90%" align="center" summary=""><tr><td class="Footer_Left"><font color="gray"><b><br>
        Copyright © 2011-2016 by NVIDIA Corporation.
          All rights reserved.
        </font></td><td class="Footer_Right"><font color="gray">
           PG_06076-R24<br>
        Revised: 11 May 2016
        </font></td></tr></table></footer></body></html>